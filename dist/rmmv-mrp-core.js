//=============================================================================
// RPG Maker MV MRP Core Module
// rmmv-mrp-core.js
// Version: 0.0.18
//=============================================================================

//=============================================================================
/*:
 * @plugindesc A collection of utilities for RPG Maker MV game designers and
 * plugin writers.
 * @author Mark Przepiora
 *
 * @help
 * ============================================================================
 * Instructions
 * ============================================================================
 *
 * Please look on GitHub for complete instructions:
 * https://github.com/markprzepiora/rmmv-mrp-core
 */
//=============================================================================

!function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=30)}([function(n,t,e){"use strict";var r=e(2);const o={TILE_WIDTH_PX:null,TILE_HEIGHT_PX:null,SCREEN_WIDTH_PX:null,SCREEN_HEIGHT_PX:null,SCREEN_WIDTH_TILES:null,SCREEN_HEIGHT_TILES:null,MAP_WIDTH_TILES:null,MAP_HEIGHT_TILES:null,MAP_WIDTH_PX:null,MAP_HEIGHT_PX:null,MAP_WIDTH_PAGES:null,MAP_HEIGHT_PAGES:null};r.a.on("game.start",function(){o.SCREEN_WIDTH_PX=SceneManager._screenWidth,o.SCREEN_HEIGHT_PX=SceneManager._screenHeight}),r.a.on("map.setup",function(){o.TILE_WIDTH_PX=$gameMap.tileWidth(),o.TILE_HEIGHT_PX=$gameMap.tileHeight(),o.SCREEN_WIDTH_TILES=Math.floor(o.SCREEN_WIDTH_PX/o.TILE_WIDTH_PX),o.SCREEN_HEIGHT_TILES=Math.floor(o.SCREEN_HEIGHT_PX/o.TILE_HEIGHT_PX),o.MAP_WIDTH_TILES=$dataMap.width,o.MAP_HEIGHT_TILES=$dataMap.height,o.MAP_WIDTH_PX=o.MAP_WIDTH_TILES*o.TILE_WIDTH_PX,o.MAP_HEIGHT_PX=o.MAP_HEIGHT_TILES*o.TILE_HEIGHT_PX,o.MAP_WIDTH_PAGES=Math.ceil(o.MAP_WIDTH_PX/o.SCREEN_WIDTH_PX),o.MAP_HEIGHT_PAGES=Math.ceil(o.MAP_HEIGHT_PX/o.SCREEN_HEIGHT_PX)}),t.a=o},function(n,t,e){"use strict";e.r(t),e.d(t,"events",function(){return u}),e.d(t,"event",function(){return a}),e.d(t,"info",function(){return i});var r=e(6),o=e.n(r);function u(n=(()=>!0)){return $gameMap.events().map(n=>c(n.eventId())).filter(n)}function a(n){return"number"==typeof n?c(n):function(n){const t=o()(t=>t&&t.name===n,$dataMap.events);if(t<0)throw`could not find event with name ${n}`;return c(t)}(n)}function i(){return $dataMapInfos[$gameMap.mapId()]}function c(n){const t=$dataMap.events[n],e=$gameMap._events[n];if(!t)throw`could not find event definition with id ${n}`;if(!e)throw`could not find event instance with id ${n}`;return{definition:t,instance:e,id:n}}},function(n,t,e){"use strict";var r=e(5),o=e.n(r),u=e(1);const a=o()({});function i(n,t,e){const r=n.prototype[t];n.prototype[t]=function(){return e(r.bind(this),...arguments)}}function c(n,t,e){const r=n[t];n[t]=function(){return e(r.bind(n),...arguments)}}function f(n,t,e,r){n(t,e,function(n,...t){a.emit(r+".before"),n(...t),a.emit(r+".after"),a.emit(r)})}function s(n,t,e){f(i,n,t,e)}function l(n,t,e){f(c,n,t,e)}s(Game_Troop,"onBattleStart","battle.start"),s(Game_Troop,"onBattleEnd","battle.end"),s(Game_Map,"setup","map.setup"),l(BattleManager,"endTurn","turn.end"),l(BattleManager,"startTurn","turn.start"),l(BattleManager,"startAction","battleAction.start"),l(BattleManager,"endAction","battleAction.end"),l(SceneManager,"run","game.start"),s(Game_Player,"executeMove","player.move"),a.onMap=function(n,t){return a.on("map.setup",function(){u.info().id!==n&&u.info().name!==n||t()}),function(){a.off(observer)}},a.onRegion=function(n,t){return a.on("player.move",function(){$gamePlayer.regionId()===n&&t()}),function(){a.off(observer)}},t.a=a},function(n,t,e){"use strict";var r=e(14)();n.exports=function(n){return n!==r&&null!==n}},function(n,t,e){var r=e(22);n.exports=function(n){return function t(e,o){var u=arguments.length;return 0===u?t:1===u&&null!=e&&!0===e["@@functional/placeholder"]?t:1===u?r(function(t){return n(e,t)}):2===u&&null!=e&&!0===e["@@functional/placeholder"]&&null!=o&&!0===o["@@functional/placeholder"]?t:2===u&&null!=e&&!0===e["@@functional/placeholder"]?r(function(t){return n(t,o)}):2===u&&null!=o&&!0===o["@@functional/placeholder"]?r(function(t){return n(e,t)}):n(e,o)}}},function(n,t,e){"use strict";var r,o,u,a,i,c,f,s=e(7),l=e(21),p=Function.prototype.apply,d=Function.prototype.call,_=Object.create,h=Object.defineProperty,v=Object.defineProperties,E=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};o=function(n,t){var e,o;return l(t),o=this,r.call(this,n,e=function(){u.call(o,n,e),p.call(t,this,arguments)}),e.__eeOnceListener__=t,this},i={on:r=function(n,t){var e;return l(t),E.call(this,"__ee__")?e=this.__ee__:(e=y.value=_(null),h(this,"__ee__",y),y.value=null),e[n]?"object"==typeof e[n]?e[n].push(t):e[n]=[e[n],t]:e[n]=t,this},once:o,off:u=function(n,t){var e,r,o,u;if(l(t),!E.call(this,"__ee__"))return this;if(!(e=this.__ee__)[n])return this;if("object"==typeof(r=e[n]))for(u=0;o=r[u];++u)o!==t&&o.__eeOnceListener__!==t||(2===r.length?e[n]=r[u?0:1]:r.splice(u,1));else r!==t&&r.__eeOnceListener__!==t||delete e[n];return this},emit:a=function(n){var t,e,r,o,u;if(E.call(this,"__ee__")&&(o=this.__ee__[n]))if("object"==typeof o){for(e=arguments.length,u=new Array(e-1),t=1;t<e;++t)u[t-1]=arguments[t];for(o=o.slice(),t=0;r=o[t];++t)p.call(r,this,u)}else switch(arguments.length){case 1:d.call(o,this);break;case 2:d.call(o,this,arguments[1]);break;case 3:d.call(o,this,arguments[1],arguments[2]);break;default:for(e=arguments.length,u=new Array(e-1),t=1;t<e;++t)u[t-1]=arguments[t];p.call(o,this,u)}}},c={on:s(r),once:s(o),off:s(u),emit:s(a)},f=v({},c),n.exports=t=function(n){return null==n?_(f):v(Object(n),c)},t.methods=i},function(n,t,e){var r=e(4),o=e(23),u=e(27);n.exports=r(o("findIndex",u,function(n,t){for(var e=0,r=t.length;e<r;){if(n(t[e]))return e;e+=1}return-1}))},function(n,t,e){"use strict";var r=e(8),o=e(16),u=e(17),a=e(18);(n.exports=function(n,t){var e,u,i,c,f;return arguments.length<2||"string"!=typeof n?(c=t,t=n,n=null):c=arguments[2],null==n?(e=i=!0,u=!1):(e=a.call(n,"c"),u=a.call(n,"e"),i=a.call(n,"w")),f={value:t,configurable:e,enumerable:u,writable:i},c?r(o(c),f):f}).gs=function(n,t,e){var i,c,f,s;return"string"!=typeof n?(f=e,e=t,t=n,n=null):f=arguments[3],null==t?t=void 0:u(t)?null==e?e=void 0:u(e)||(f=e,e=void 0):(f=t,t=e=void 0),null==n?(i=!0,c=!1):(i=a.call(n,"c"),c=a.call(n,"e")),s={get:t,set:e,configurable:i,enumerable:c},f?r(o(f),s):s}},function(n,t,e){"use strict";n.exports=e(9)()?Object.assign:e(10)},function(n,t,e){"use strict";n.exports=function(){var n,t=Object.assign;return"function"==typeof t&&(t(n={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),n.foo+n.bar+n.trzy==="razdwatrzy")}},function(n,t,e){"use strict";var r=e(11),o=e(15),u=Math.max;n.exports=function(n,t){var e,a,i,c=u(arguments.length,2);for(n=Object(o(n)),i=function(r){try{n[r]=t[r]}catch(n){e||(e=n)}},a=1;a<c;++a)t=arguments[a],r(t).forEach(i);if(void 0!==e)throw e;return n}},function(n,t,e){"use strict";n.exports=e(12)()?Object.keys:e(13)},function(n,t,e){"use strict";n.exports=function(){try{return Object.keys("primitive"),!0}catch(n){return!1}}},function(n,t,e){"use strict";var r=e(3),o=Object.keys;n.exports=function(n){return o(r(n)?Object(n):n)}},function(n,t,e){"use strict";n.exports=function(){}},function(n,t,e){"use strict";var r=e(3);n.exports=function(n){if(!r(n))throw new TypeError("Cannot use null or undefined");return n}},function(n,t,e){"use strict";var r=e(3),o=Array.prototype.forEach,u=Object.create;n.exports=function(n){var t=u(null);return o.call(arguments,function(n){r(n)&&function(n,t){var e;for(e in n)t[e]=n[e]}(Object(n),t)}),t}},function(n,t,e){"use strict";n.exports=function(n){return"function"==typeof n}},function(n,t,e){"use strict";n.exports=e(19)()?String.prototype.contains:e(20)},function(n,t,e){"use strict";var r="razdwatrzy";n.exports=function(){return"function"==typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},function(n,t,e){"use strict";var r=String.prototype.indexOf;n.exports=function(n){return r.call(this,n,arguments[1])>-1}},function(n,t,e){"use strict";n.exports=function(n){if("function"!=typeof n)throw new TypeError(n+" is not a function");return n}},function(n,t){n.exports=function(n){return function t(e){return 0===arguments.length?t:null!=e&&!0===e["@@functional/placeholder"]?t:n.apply(this,arguments)}}},function(n,t,e){var r=e(24),o=e(25),u=e(26);n.exports=function(n,t,e){return function(){var a=arguments.length;if(0===a)return e();var i=arguments[a-1];if(!r(i)){var c=u(arguments,0,a-1);if("function"==typeof i[n])return i[n].apply(i,c);if(o(i))return t.apply(null,c)(i)}return e.apply(this,arguments)}}},function(n,t){n.exports=Array.isArray||function(n){return null!=n&&n.length>=0&&"[object Array]"===Object.prototype.toString.call(n)}},function(n,t){n.exports=function(n){return"function"==typeof n["@@transducer/step"]}},function(n,t){n.exports=function n(t,e,r){switch(arguments.length){case 1:return n(t,0,t.length);case 2:return n(t,e,t.length);default:for(var o=[],u=0,a=Math.max(0,Math.min(t.length,r)-e);u<a;)o[u]=t[e+u],u+=1;return o}}},function(n,t,e){var r=e(4),o=e(28),u=e(29);n.exports=function(){function n(n,t){this.xf=t,this.f=n,this.idx=-1,this.found=!1}return n.prototype["@@transducer/init"]=u.init,n.prototype["@@transducer/result"]=function(n){return this.found||(n=this.xf["@@transducer/step"](n,-1)),this.xf["@@transducer/result"](n)},n.prototype["@@transducer/step"]=function(n,t){return this.idx+=1,this.f(t)&&(this.found=!0,n=o(this.xf["@@transducer/step"](n,this.idx))),n},r(function(t,e){return new n(t,e)})}()},function(n,t){n.exports=function(n){return n&&n["@@transducer/reduced"]?n:{"@@transducer/value":n,"@@transducer/reduced":!0}}},function(n,t){n.exports={init:function(){return this.xf["@@transducer/init"]()},result:function(n){return this.xf["@@transducer/result"](n)}}},function(n,t,e){"use strict";e.r(t);var r={};e.r(r),e.d(r,"_tokenize",function(){return Y}),e.d(r,"parse",function(){return U}),e.d(r,"extractAll",function(){return Z}),e.d(r,"extractFirst",function(){return Q}),e.d(r,"extractFirstOfType",function(){return J}),e.d(r,"extractAllOfType",function(){return q});var o={};e.r(o),e.d(o,"run",function(){return tn});var u={};e.r(u),e.d(u,"findItem",function(){return en});var a={};e.r(a),e.d(a,"addItem",function(){return rn}),e.d(a,"clearItem",function(){return on});var i={};e.r(i),e.d(i,"install",function(){return an});var c={};e.r(c),e.d(c,"add",function(){return fn}),e.d(c,"install",function(){return sn});var f={};e.r(f),e.d(f,"GameObserver",function(){return s.a}),e.d(f,"OptionParser",function(){return r}),e.d(f,"Geometry",function(){return nn.a}),e.d(f,"CommonEvents",function(){return o}),e.d(f,"Inventory",function(){return a}),e.d(f,"Database",function(){return u}),e.d(f,"Map",function(){return un}),e.d(f,"ChangeTextSpeed",function(){return i}),e.d(f,"PluginCommands",function(){return c});var s=e(2);function l(n,t,e,r){return{type:n,token:t,pos:e,string:r}}function p(n,t){return{tokens:n,newCharacterStream:t}}function d(n,t=0){return{buffer:n,pos:t,length:n.length-t,present:t<n.length,empty:t>=n.length,rest:()=>n.slice(t),get:()=>n[t],advance:(e=1)=>d(n,t+e),take:e=>n.slice(t,t+e)}}function _(n,t=0){const e=n.length>0?n[0].string:"";return{...d(n,t),advance:(e=1)=>_(n,t+e),ofType:e=>t<n.length&&n[t].type===e,string:e}}function h(n,t,e=""){var r=new RegExp(/^/.source+t.source,e);return function(t,e){var o;return(o=e.rest().match(r))?p([e.Token(n,o[0])],e.advance(o[0].length)):null}}function v(n){return function(t,e){var r;return(r=n(t,e))?p([],r.newCharacterStream):p([],e)}}function E(n,t,e,...r){const o=(u=n,a=t,function(n,t){const e=u(n,t);if(!e)return null;const r=a([...n,...e.tokens],e.newCharacterStream);return r?p([...e.tokens,...r.tokens],r.newCharacterStream):null});var u,a;return e?E(o,e,...r):o}function y(n){return function(t,e){const r=t[t.length-1];return r&&r.type==n?p([],e):null}}function T(...n){return function(t,e){for(var r,o=0;o<n.length;o++)if(r=n[o](t,e))return r;return null}}function g(n){return function(t,e){for(var r=[],o=0;e.present;){var u=n(r,e);if(!u)break;if(r=[...r,...u.tokens],u.newCharacterStream.pos===e.pos)return p(r,u.newCharacterStream);if(o++>1e4)throw"tried to lex more than 10,000 tokens - this is probably a bug.";e=u.newCharacterStream}return p(r,e)}}function I(n,t){return function(e,r){var o=n(e,r);return o?t([...e,...o.tokens],o.newCharacterStream)?null:o:null}}const m=h("BRA",/</),b=h("KET",/>/),S=(w=h("WHITESPACE",/\s+/),function(n,t){var e;return(e=w(n,t))?p([],e.newCharacterStream):null});var w;const P=h("IDENTIFIER",/[a-zA-Z_][a-zA-Z0-9-_]*/),H=h("KEY",/[a-zA-Z_][a-zA-Z0-9-_]*/),A=h("KEYVALSEP",/:/),M=(E(H,v(S),A),h("SLASH",/\//)),x=h("SIGNIFICANT_WHITESPACE",/\s+/),C=h("BAREWORD",/[^,:><"\s]+/),O=(G="BARESTRING",R=E(C,g(I(E(x,C),E(v(S),A)))),function(n,t){var e=R(n,t);if(e){var r=e.tokens.map(n=>n.token).join("");return p([t.Token(G,r)],e.newCharacterStream)}return null});var G,R;const L=n=>JSON.parse(n.replace(/\n/g,"\\n")),N=h("COMMA",/,/),j=h("NUMBER",/-?[0-9]+(\.[0-9]+)?/),k=h("BOOLEAN",/(true|false)/,"i"),W=h("QUOTEDSTRING",/"(\\.|[^"\\])*"/),D=(X=T(S,m,b,N,E(H,v(S),A),E(y("BRA"),v(S),I(P,N)),E(y("BRA"),M,v(S),P,v(S),b),A,j,k,W,O),function(n){var t=function n(t,e=0){return{...d(t,e),advance:(r=1)=>n(t,e+r),flush:()=>n(t,t.length),Token:(n,r)=>l(n,r,e,t)}}(n);return g(T(X,h("UNKNOWN",/[^]*/)))([],t).tokens});var X;function B(n){for(var t,e,r,o={args:[]};t=$(n);)if([e,r]=t,"object"==typeof e){o={...o,...e};var u=r.ofType("COMMA"),a=r.ofType("KEY")&&r.advance().ofType("KEYVALSEP");if(u)n=r.advance();else{if(!a)return[o,r];n=r}}else{if(o={...o,args:o.args.concat(e)},r.empty||"COMMA"!=r.get().type)return[o,r];n=r.advance()}return[o,n]}function $(n){return function(n){if(n.length<3)return null;if(!n.ofType("KEY")||!n.advance().ofType("KEYVALSEP"))return null;const t=z(n.advance(2));if(!t)return null;return[{[n.get().token]:t[0]},n.advance(3)]}(n)||z(n)}function z(n){if(n.empty)return null;const{token:t,type:e}=n.get();switch(e){case"NUMBER":return[Number(t),n.advance()];case"QUOTEDSTRING":return[L(t),n.advance()];case"BARESTRING":case"KEY":return[t,n.advance()];case"BOOLEAN":return["true"===t.toLowerCase(),n.advance()];default:return null}}const K=n=>n.replace(/^\n/,"").replace(/\n$/,"");function F(n){return function(n){if(n.length<3)return null;if(!n.ofType("BRA"))return null;const t=B(n.advance());if(!t)return null;const[e,r]=t;return r.ofType("KET")?[e,r.advance()]:null}(n)||function(n){if(n.length<3)return null;const t=n.advance();if(!n.ofType("BRA")||!t.ofType("IDENTIFIER"))return null;const e=B(n.advance(2));if(!e)return null;const[r,o]=e;if(!o.ofType("KET"))return null;const u=t.get().token,a=function(n,t){for(;t.present;){if(n(t))return t;t=t.advance()}return null}(function(n){return function(n,t){for(var e=0;e<n.length;e++)if(!t.advance(e).ofType(n[e]))return!1;return!0}(["BRA","SLASH","IDENTIFIER","KET"],n)&&n.advance(2).get().token===u},o.advance());if(a){const n=o.get().string.slice(o.get().pos+1,a.get().pos);return[{...r,type:u,block:K(n)},a.advance(4)]}return[{...r,type:u},o.advance()]}(n)}const Y=n=>_(D(n));function U(n){return t=_(D(n)),(e=F(t))?e[0]:null;var t,e}function Z(n){for(var t=_(D(n)),e=[];t.present;){var r=F(t);r?(e.push(r[0]),t=r[1]):t=t.advance()}return e}function V(n){return function(t){for(var e=_(D(t));e.present;){var r=F(e);if(r&&n(r[0]))return r[0];e=e.advance()}return null}}const Q=V(()=>!0);function J(n,t){return V(n=>n.type===t)(n)}function q(n,t){return Z(n).filter(n=>n.type===t)}var nn=e(0);function tn(n){$gameTemp.reserveCommonEvent(n)}function en(n){return $dataItems[n]}function rn(n,t=1){return $gameParty.gainItem(en(n),t)}function on(n){rn(n,-99999)}var un=e(1);function an(){const n=Window_Base.prototype.processCharacter;Window_Base.prototype.processCharacter=function(t){return void 0===t.slowdown?n.apply(this,arguments):(void 0===t.slowdownCounter&&(t.slowdownCounter=0),t.slowdownCounter++>=t.slowdown?(t.slowdownCounter=0,n.apply(this,arguments)):void 0)};const t=Window_Message.prototype.processEscapeCharacter;Window_Message.prototype.processEscapeCharacter=function(n,e){if("S"===n){const n=Number(this.obtainEscapeParam(e));e.slowdown=n||null}else t.apply(this,arguments)}}var cn={};function fn(n,t){n.constructor!==Array&&(n=[n]),n.forEach(n=>{cn[n.toLowerCase()]=t})}function sn(){var n;n=Game_Interpreter.prototype.pluginCommand,Game_Interpreter.prototype.pluginCommand=function(t,e){n.apply(this,arguments);var r=cn[t.toLowerCase()];r&&r.apply(this,arguments)}}i.install(),c.install(),window.MRP=f}]);